<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNW Tour Map</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Custom Scrollbar for the list */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        /* Leaflet Popup Styles */
        .leaflet-popup-content-wrapper {
            border-radius: 0.5rem;
            padding: 0;
            overflow: hidden;
        }
        .leaflet-popup-content {
            margin: 0;
            width: 280px !important;
        }
        /* Leaflet Tooltip Styles */
        .custom-tooltip {
            background: rgba(30, 41, 59, 0.9);
            border: none;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .custom-tooltip::before {
            border-top-color: rgba(30, 41, 59, 0.9);
        }
        /* Smooth Icon Transition */
        .custom-div-icon div {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</head>
<body class="bg-slate-50 h-screen w-screen flex flex-col md:flex-row overflow-hidden text-slate-800 font-sans">

    <!-- Sidebar (List View) -->
    <div class="w-full md:w-[400px] h-[45%] md:h-full bg-white shadow-xl z-20 flex flex-col border-r border-slate-200">
        <!-- Header -->
        <div class="p-5 border-b border-slate-100 bg-white">
            <h1 class="text-2xl font-bold text-slate-800 tracking-tight">PDX-Gorge Trip Planner</h1>
            <p class="text-sm text-slate-500 mt-1">Oregon & Washington Gorge Loop</p>
            
            <!-- Filters -->
            <div class="flex gap-2 mt-4 overflow-x-auto pb-1 scrollbar-hide no-wrap" id="filter-container">
                <button onclick="filterMap('all')" class="filter-btn active px-3 py-1 text-xs font-semibold rounded-full bg-slate-800 text-white whitespace-nowrap transition-colors">All</button>
                <button onclick="filterMap('must')" class="filter-btn px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-colors">Must See</button>
                <button onclick="filterMap('mountain')" class="filter-btn px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-colors">Views</button>
                <button onclick="filterMap('food')" class="filter-btn px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-colors">Food</button>
                <button onclick="filterMap('coffee')" class="filter-btn px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-colors">Coffee</button>
                <button onclick="filterMap('restroom')" class="filter-btn px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-colors">Restroom</button>
            </div>
        </div>

        <!-- Scrollable List -->
        <div id="location-list" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-3 bg-slate-50">
            <!-- List items injected here by JS -->
        </div>
    </div>

    <!-- Map Container -->
    <div id="map" class="w-full md:flex-1 h-[55%] md:h-full z-10 bg-slate-200 relative">
        <!-- Map loading placeholder -->
        <div class="absolute inset-0 flex items-center justify-center text-slate-400">
            <i class="fas fa-map fa-spin text-4xl"></i>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // ==========================================
        //  üìç YOUR LOCATION DATA (EDIT HERE)
        // ==========================================
        const locations = [
            // --- MUST SEE ---
            {
                id: 'must1', name: "Multnomah Falls", type: 'must', category: 'list-must-see', checked: true, locked: true,
                lat: 45.5762, lng: -122.1158,
                desc: "Iconic two-tiered waterfall. A PNW classic.",
                img: "https://cdn.recreation.gov/public/2022/05/02/22/14/10089144_294d29b8-5224-477d-b561-6a97900f5a0f_700.webp"
            },
            {
                id: 'must2a', name: "Stonehenge Memorial", type: 'must', category: 'list-must-see', checked: true, locked: true,
                lat: 45.6957, lng: -120.8062,
                desc: "Full-scale replica of Stonehenge in Maryhill, WA.",
                img: "https://www.maryhillmuseum.org/wp-content/uploads/2025/02/Instagram-drrennie-Stonehenge-Memorial-Monument.jpg"
            },
            {
                id: 'must2b', name: "Maryhill Museum of Art", type: 'must', category: 'list-must-see', checked: true, locked: true,
                lat: 45.6792, lng: -120.8550,
                desc: "Eclectic collections in a castle-like chateau.",
                img: "https://www.maryhillmuseum.org/wp-content/uploads/2019/04/museumLupines-cropped-1080x675.jpg"
            },

            // --- OPTIONAL VIEWS & MOUNTAINS ---
            {
                id: 'opt1', name: "Hood River Lavender", type: 'mountain', category: 'list-optional', checked: false,
                lat: 45.6115, lng: -121.5543,
                desc: "Beautiful lavender fields with mountain views.",
                img: "https://scontent-bos5-1.xx.fbcdn.net/v/t39.30808-6/514268129_122218996514157079_4312096840420558546_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=aa7b47&_nc_ohc=CR0c4EQ5oEoQ7kNvwE2ULAB&_nc_oc=AdniIkweqKpI02ZnYrR3jnjWqtkP9smirs-5Sq23E1RtexDfLqXO1tHYc7dHkNx9Sy0&_nc_zt=23&_nc_ht=scontent-bos5-1.xx&_nc_gid=5x_L0rUtFN1idH7m95h6CA&oh=00_AfqfTO1PzvmTYcyvRpVfai9Vqx6nEOtN_esJP91oIPOQ4g&oe=6971CA94"
            },
            {
                id: 'opt2', name: "Beacon Rock", type: 'mountain', category: 'list-optional', checked: false,
                lat: 45.6280, lng: -122.0221,
                desc: "The core of an ancient volcano.",
                img: "https://www.wta.org/site_images/hikes/beacon-rock-by-cagey.jpeg/@@images/02dd0ae4-3dfa-4a25-9a75-3768eccf8c5c.jpeg"
            },
            {
                id: 'opt3', name: "Jonsrud Viewpoint", type: 'mountain', category: 'list-optional', checked: false,
                lat: 45.4121, lng: -122.2720,
                desc: "Stunning view of Mount Hood from Sandy, OR.",
                img: "https://traveloregon.com/wp-content/uploads/2023/10/23Nov_Sandy_Jonsrud.jpg"
            },
            {
                id: 'opt4', name: "Timberline Lodge", type: 'mountain', category: 'list-optional', checked: false,
                lat: 45.3311, lng: -121.7112,
                desc: "Historic ski lodge on the south slope of Mt. Hood.",
                img: "https://timberlinelodge.com/site/assets/files/5256/patio_in_the_summer.1600x1818.webp"
            },

            // --- COFFEE ---
            {
                id: 'coffee1', name: "Randonn√©e Coffee", type: 'coffee', category: 'list-coffee', checked: false,
                lat: 45.6833, lng: -121.3968, 
                desc: "Cozy spot in Mosier. Restroom available.",
                img: "https://s3-media0.fl.yelpcdn.com/bphoto/nGbycDy0mtp9IPgLRFLBgg/o.jpg"
            },
            {
                id: 'coffee2', name: "Stomping Grounds Fairview", type: 'coffee', category: 'list-coffee', checked: false,
                lat: 45.5398, lng: -122.4398,
                desc: "Coffee House in Fairview.",
                img: "https://bridgetownbites.com/wp-content/uploads/2025/07/stomping-grounds-menu-fairview-oregon-1303x1536.jpg"
            },
            {
                id: 'coffee3', name: "Stomping Grounds: Drive Thru", type: 'coffee', category: 'list-coffee', checked: false,
                lat: 45.5037, lng: -122.4251, 
                desc: "Quick drive-thru stop in Gresham.",
                img: "https://images.squarespace-cdn.com/content/v1/66450f8572564a47c4a41ec7/1715801996887-DMLEFGFLFAMWJ6WV1D0D/AHibbetts-28.jpg?format=2500w"
            },

            // --- FOOD ---
            {
                id: 'food1', name: "Excellent Cuisine", type: 'food', category: 'list-food', checked: false,
                lat: 45.5050, lng: -122.5729,
                desc: "Dim Sum on Division St.",
                img: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/25/4e/52/1c/excellent-cuisine.jpg?w=900&h=500&s=1"
            },
            {
                id: 'food2', name: "T√®o Bun Bo Hue", type: 'food', category: 'list-food', checked: false,
                lat: 45.5118, lng: -122.5790,
                desc: "Vietnamese Pho and specialty soups.",
                img: "https://lh3.googleusercontent.com/pw/AP1GczPRpGGum-qTPsjjt_rIQ6jKuVzsV_1q09OEFmETiC5oj2vv1sIMuvSUCRakYK5MxhkkE5AbN5P4dTaErElTwYMn6bidQRzOYFTaKJhDfuMbl7AqhudMzahxP30l0-kaRy6a4HVwP5ZzTOdzqM3M538q4g=w2134-h1600-s-no"
            },
            {
                id: 'food3', name: "Nicholas Restaurant", type: 'food', category: 'list-food', checked: false,
                lat: 45.5119, lng: -122.6534,
                desc: "Lebanese and Mediterranean cuisine.",
                img: "https://lh3.googleusercontent.com/p/AF1QipNduJrdNlz3n0KWQVaC7zQiTEIFrlSDyLrj6H5G=s1360-w1360-h1020-rw"
            },
            {
                id: 'food4', name: "Noodle Man", type: 'food', category: 'list-food', checked: false,
                lat: 45.4300, lng: -122.5740, 
                desc: "Lanzhou beef noodle & Knife sliced noodle.",
                img: "https://s3-media0.fl.yelpcdn.com/bphoto/oRlNKvvp2BAtm5YD9kR8Vg/o.jpg"
            },
            {
                id: 'food5', name: "Master Kong (SE Division)", type: 'food', category: 'list-food', checked: false,
                lat: 45.5065, lng: -122.5758, 
                desc: "ËÇâÂ§æÈ•É,ÁÖéÈ§ÖËèìÂ≠ê,ÁöÆËõãÁò¶ËÇâÁ≤•,ÁîüÁÖéÂåÖ",
                img: "https://lh3.googleusercontent.com/gg/AIJ2gl9FxKPkPPKtFKX92Jbc1gmN7Egd5FwZZt8N0mqBUjrUEPM9R7DHqfE_bMQg2TyZwIIGNxoxsXAsl2j61yeI-zWOm0PjiyWMxx7xN0xkl0NR0SWsM7YwMCWxPlJR1F6N0ciVNjASdNEBGAdHMAeb_QmfgRSdD3peyl_V-Agx5tJ-wilmbaEj=s1024-rj-mp2"
            },
            {
                id: 'food6', name: "Master Kong (SE Hawthorne)", type: 'food', category: 'list-food', checked: false,
                lat: 45.5135, lng: -122.6331, 
                desc: "ËÇâÂ§æÈ•É,ÁÖéÈ§ÖËèìÂ≠ê,ÁöÆËõãÁò¶ËÇâÁ≤•,Êù±ÂåóÈ§ÉÂ≠ê",
                img: "https://lh3.googleusercontent.com/gps-cs-s/AG0ilSxJMUgvuypJiGTGbi26T7A86xjXuR_GSLI6iN_CGLeh_5zIz7Eb1YlYpsFWZ-nJeHOt9FKxzgnWEmBQoE6FeYHvKkSToY4jSdc7e5V3rtNRBXoezqXfneZxVynuTXHUpn_c_Ex_=s1360-w1360-h1020-rw"
            },

            // --- RESTROOMS ---
            {
                id: 'rr1', name: "Columbia Gorge Outlets", type: 'restroom', category: 'list-restroom', checked: false,
                lat: 45.5392, lng: -122.3905,
                desc: "Troutdale. Clean restroom stop.",
                img: "https://media-cdn.tripadvisor.com/media/photo-m/1280/1d/84/a1/22/caption.jpg"
            },
            {
                id: 'rr2', name: "Glenn Otto Community Park", type: 'restroom', category: 'list-restroom', checked: false,
                lat: 45.5412, lng: -122.3835,
                desc: "Troutdale park near the river.",
                img: "https://bestofthenorthwest.com/wp-content/uploads/2021/07/SugarPineJuly2018-292-768x512.jpg"
            },
            {
                id: 'rr3', name: "Bradford Island Visitor Center", type: 'restroom', category: 'list-restroom', checked: false,
                lat: 45.6420, lng: -121.9398,
                desc: "Bonneville Dam visitor area.",
                img: "https://www.nps.gov/common/uploads/cropped_image/primary/76ADADB9-F019-FA9C-56BCCEAD6D948EA2.jpg?width=1600&quality=90&mode=crop"
            }
        ];

        // ==========================================
        //  üó∫Ô∏è MAP LOGIC
        // ==========================================

        const map = L.map('map').setView([45.5762, -121.5], 9);
        let markers = {};
        let currentFilter = 'all';

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        const getIcon = (type, highlighted = false) => {
            let color = 'bg-blue-500';
            let iconClass = 'fa-map-marker-alt';
            
            // Standard colors
            if (type === 'must') { color = 'bg-red-500'; iconClass = 'fa-star'; }
            else if (type === 'mountain') { color = 'bg-emerald-600'; iconClass = 'fa-mountain'; }
            else if (type === 'coffee') { color = 'bg-amber-700'; iconClass = 'fa-mug-hot'; }
            else if (type === 'food') { color = 'bg-orange-500'; iconClass = 'fa-utensils'; }
            else if (type === 'restroom') { color = 'bg-slate-500'; iconClass = 'fa-restroom'; }

            // Scale factor for highlighted state
            const scaleClass = highlighted ? 'scale-125 z-50 ring-4 ring-white/50' : 'scale-100 shadow-lg';
            const size = highlighted ? 40 : 32;
            const anchor = highlighted ? [20, 40] : [16, 32];

            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="${color} ${scaleClass} w-8 h-8 rounded-full border-2 border-white flex items-center justify-center text-white transform transition-all duration-200"><i class="fas ${iconClass} text-sm"></i></div>`,
                iconSize: [32, 32], // Wrapper size remains constant to prevent jumpiness, inner div scales
                iconAnchor: [16, 32],
                popupAnchor: [0, -32],
                tooltipAnchor: [16, -16]
            });
        };

        // Helper to highlight a marker
        function setMarkerHighlight(id, highlight) {
            const marker = markers[id];
            const loc = locations.find(l => l.id === id);
            if (marker && loc) {
                marker.setIcon(getIcon(loc.type, highlight));
                if(highlight) marker.setZIndexOffset(1000);
                else marker.setZIndexOffset(0);
            }
        }

        // Helper to highlight a list item
        function setListHighlight(id, highlight) {
            const el = document.getElementById(`loc-item-${id}`);
            if (el) {
                if (highlight) {
                    el.classList.add('bg-blue-50', 'border-blue-300', 'ring-1', 'ring-blue-300');
                    el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    el.classList.remove('bg-blue-50', 'border-blue-300', 'ring-1', 'ring-blue-300');
                }
            }
        }

        function render() {
            const listContainer = document.getElementById('location-list');
            listContainer.innerHTML = '';
            
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            markers = {};

            locations.forEach(loc => {
                if (currentFilter !== 'all' && loc.type !== currentFilter) return;

                // 1. Create Marker
                const marker = L.marker([loc.lat, loc.lng], { icon: getIcon(loc.type) })
                    .addTo(map)
                    .bindTooltip(loc.name, { 
                        direction: 'top', 
                        className: 'custom-tooltip',
                        opacity: 1
                    })
                    .bindPopup(`
                        <div class="flex flex-col">
                            <div class="h-32 w-full bg-slate-200 overflow-hidden relative">
                                <img src="${loc.img}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/400x300?text=No+Image'">
                                <div class="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-1 rounded text-xs font-bold uppercase tracking-wider text-slate-700 shadow-sm">${loc.type}</div>
                            </div>
                            <div class="p-4 bg-white">
                                <h3 class="font-bold text-lg text-slate-800 mb-1">${loc.name}</h3>
                                <p class="text-sm text-slate-600 leading-snug mb-3">${loc.desc}</p>
                                <a href="https://www.google.com/maps/dir/?api=1&destination=${loc.lat},${loc.lng}" target="_blank" class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 rounded transition-colors">
                                    <i class="fas fa-location-arrow mr-1"></i> Directions
                                </a>
                            </div>
                        </div>
                    `);
                
                // Marker Events (Map -> List)
                marker.on('mouseover', () => {
                    setListHighlight(loc.id, true);
                    setMarkerHighlight(loc.id, true); // Keep marker big while hovering it
                });
                marker.on('mouseout', () => {
                    setListHighlight(loc.id, false);
                    setMarkerHighlight(loc.id, false);
                });

                markers[loc.id] = marker;

                // 2. Create Sidebar Item
                const item = document.createElement('div');
                item.id = `loc-item-${loc.id}`; // ID for finding element
                item.className = "flex bg-white p-3 rounded-lg shadow-sm border border-slate-100 cursor-pointer hover:shadow-md transition-all group";
                item.onclick = () => focusLocation(loc.id, loc.lat, loc.lng);
                
                // List Item Events (List -> Map)
                item.onmouseenter = () => setMarkerHighlight(loc.id, true);
                item.onmouseleave = () => setMarkerHighlight(loc.id, false);
                
                let badgeColor = 'bg-blue-100 text-blue-700';
                if(loc.type === 'must') badgeColor = 'bg-red-100 text-red-700';
                if(loc.type === 'mountain') badgeColor = 'bg-emerald-100 text-emerald-700';
                if(loc.type === 'coffee') badgeColor = 'bg-amber-100 text-amber-800';
                if(loc.type === 'food') badgeColor = 'bg-orange-100 text-orange-700';
                if(loc.type === 'restroom') badgeColor = 'bg-slate-100 text-slate-600';

                item.innerHTML = `
                    <div class="w-20 h-20 flex-shrink-0 rounded-md overflow-hidden bg-slate-100 relative">
                        <img src="${loc.img}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" onerror="this.src='https://placehold.co/100?text=IMG'">
                    </div>
                    <div class="ml-3 flex flex-col justify-center flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide mb-1 ${badgeColor}">${loc.type}</span>
                            ${loc.checked ? '<i class="fas fa-check-circle text-green-500 text-xs"></i>' : ''}
                        </div>
                        <h4 class="font-bold text-slate-800 text-sm truncate group-hover:text-blue-600 transition-colors">${loc.name}</h4>
                        <p class="text-xs text-slate-500 line-clamp-2 mt-0.5">${loc.desc}</p>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        function focusLocation(id, lat, lng) {
            map.flyTo([lat, lng], 13, { duration: 1.5 });
            if (markers[id]) {
                setTimeout(() => {
                    markers[id].openPopup();
                }, 1500);
            }
            if (window.innerWidth < 768) {
                document.getElementById('map').scrollIntoView({ behavior: 'smooth' });
            }
        }

        window.filterMap = (type) => {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.getAttribute('onclick').includes(type)) {
                    btn.classList.remove('bg-slate-100', 'text-slate-600');
                    btn.classList.add('bg-slate-800', 'text-white');
                } else {
                    btn.classList.add('bg-slate-100', 'text-slate-600');
                    btn.classList.remove('bg-slate-800', 'text-white');
                }
            });
            render();
            if (locations.length > 0) map.setView([45.5762, -121.5], 9);
        };

        render();

    </script>
</body>
</html>